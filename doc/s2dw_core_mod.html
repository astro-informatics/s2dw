<HTML>
<HEAD>
   <TITLE> module s2dw_core_mod (generated by f90doc) </TITLE>
  <LINK rel="stylesheet" href="stylesheet.css" type="text/css" /> </HEAD>
<H1> Module s2dw_core_mod </H1>
<PRE>module s2dw_core_mod

        ! Uses
    use <A HREF="s2dw_types_mod.html">s2dw_types_mod</A>
    use <A HREF="s2dw_error_mod.html">s2dw_error_mod</A>
    use <A HREF="s2dw_dl_mod.html">s2dw_dl_mod</A>
    use <A HREF="omp_lib.html">omp_lib</A>

        ! Types
    public type <A HREF="s2dw_core_mod.html#type_s2dw_wav_abg">s2dw_wav_abg</A>

        ! Variables
    integer, private, parameter :: <A HREF="s2dw_core_mod.html#var_fftw_estimate">FFTW_ESTIMATE</A> = 64
    integer, private, parameter :: <A HREF="s2dw_core_mod.html#var_fftw_measure">FFTW_MEASURE</A> = 0
    integer, private, parameter :: <A HREF="s2dw_core_mod.html#var_fftw_forward">FFTW_FORWARD</A> = -1
    integer, private, parameter :: <A HREF="s2dw_core_mod.html#var_fftw_backward">FFTW_BACKWARD</A> = 1

        ! Subroutines and functions
    public subroutine <A HREF="s2dw_core_mod.html#subroutine_s2dw_core_init_kernels">s2dw_core_init_kernels</A> (K_gamma, Phi2, bl_scoeff, J, B, alpha)
    private function <A HREF="s2dw_core_mod.html#function_s2dw_core_phi2_integrand">s2dw_core_phi2_integrand</A> (k, bw, alpha) result (integrand)
    public subroutine <A HREF="s2dw_core_mod.html#subroutine_s2dw_core_init_directionality">s2dw_core_init_directionality</A> (Slm, B, N)
    public function <A HREF="s2dw_core_mod.html#function_s2dw_core_admiss">s2dw_core_admiss</A> (admiss, K_gamma, Phi2, B, J) result (pass)
    public subroutine <A HREF="s2dw_core_mod.html#subroutine_s2dw_core_analysis_flm2wav">s2dw_core_analysis_flm2wav</A> (wav, scoeff, flm, K_gamma, Slm, J, B, N, bl_scoeff, alpha)
    public subroutine <A HREF="s2dw_core_mod.html#subroutine_s2dw_core_analysis_flm2wav_dynamic">s2dw_core_analysis_flm2wav_dynamic</A> (wavdyn, scoeff, flm, K_gamma, Slm, J, B, N, bl_scoeff, alpha)
    public subroutine <A HREF="s2dw_core_mod.html#subroutine_s2dw_core_synthesis_wav2flm">s2dw_core_synthesis_wav2flm</A> (flm, wav, scoeff, K_gamma, Phi2, Slm, J, B, N, bl_scoeff, alpha)
    public subroutine <A HREF="s2dw_core_mod.html#subroutine_s2dw_core_synthesis_wav2flm_dynamic">s2dw_core_synthesis_wav2flm_dynamic</A> (flm, wavdyn, scoeff, K_gamma, Phi2, Slm, J, B, N, bl_scoeff, alpha)
    public subroutine <A HREF="s2dw_core_mod.html#subroutine_s2dw_core_free_wavdyn">s2dw_core_free_wavdyn</A> (wavdyn)
    private function <A HREF="s2dw_core_mod.html#function_s2dw_core_params_valid">s2dw_core_params_valid</A> (J, B, alpha, N) result (valid)
    public function <A HREF="s2dw_core_mod.html#function_s2dw_core_comp_jmax">s2dw_core_comp_Jmax</A> (B, alpha) result (J_max)
    public function <A HREF="s2dw_core_mod.html#function_s2dw_core_assimilate_int">s2dw_core_assimilate_int</A> (x, y) result (assimilated)
    private function <A HREF="s2dw_core_mod.html#function_quad_weights">quad_weights</A> (theta_t, B) result (w)
    private function <A HREF="s2dw_core_mod.html#function_binomial">binomial</A> (n, r) result (b)
    private function <A HREF="s2dw_core_mod.html#function_logfact">logfact</A> (n) result (logfactn)
    private subroutine <A HREF="s2dw_core_mod.html#subroutine_trapzd">trapzd</A> (func, B, alpha, a_lim, b_lim, s, n)
    private function <A HREF="s2dw_core_mod.html#function_qtrap">qtrap</A> (func, B, alpha, a_lim, b_lim) result (integral)
    private function <A HREF="s2dw_core_mod.html#function_qsimp">qsimp</A> (func, B, alpha, a_lim, b_lim) result (integral)

end module s2dw_core_mod
</PRE>
 Functionality to perform scale discretised wavelet transform on the sphere.
<P>
<STRONG>Author:</STRONG> J. D. McEwen (mcewen@mrao.cam.ac.uk)
<P>
<STRONG>Version:</STRONG> 0.1 November 2007

<HR><H2> Description of Types </H2>
<A NAME="type_s2dw_wav_abg"><H3>s2dw_wav_abg</H3></A>
<PRE>public type s2dw_wav_abg
    real (kind=dp), allocatable, dimension (:,:,:) :: coeff
end type s2dw_wav_abg
</PRE>
 Structure to store wavelet coefficients for given scale.  Required for 
 dynamic memory allocation of wavelet coefficients.

<HR><H2> Description of Variables </H2>
<A NAME="var_fftw_estimate"><H3>FFTW_ESTIMATE</H3></A>
<PRE>integer, private, parameter :: FFTW_ESTIMATE = 64
</PRE>
<A NAME="var_fftw_measure"><H3>FFTW_MEASURE</H3></A>
<PRE>integer, private, parameter :: FFTW_MEASURE = 0
</PRE>
<A NAME="var_fftw_forward"><H3>FFTW_FORWARD</H3></A>
<PRE>integer, private, parameter :: FFTW_FORWARD = -1
</PRE>
<A NAME="var_fftw_backward"><H3>FFTW_BACKWARD</H3></A>
<PRE>integer, private, parameter :: FFTW_BACKWARD = 1
</PRE>

<HR><H2> Description of Subroutines and Functions </H2>
<A NAME="subroutine_s2dw_core_init_kernels"><H3>s2dw_core_init_kernels</H3></A>
<PRE>public subroutine s2dw_core_init_kernels (K_gamma, Phi2, bl_scoeff, J, B, alpha)
    real (kind=dp), intent(out), dimension (0:J,0:B-1) :: K_gamma
    real (kind=dp), intent(out), dimension (0:B-1) :: Phi2
    integer, intent(out) :: bl_scoeff
    integer, intent(in) :: J
    integer, intent(in) :: B
    real (kind=dp), intent(in) :: alpha
    ! Calls: s2dw_error
end subroutine s2dw_core_init_kernels
</PRE>
 Compute kernels, scaling functions and band limits.
<P>
 Notes:
  <UL>
  <LI>  Kernels are computed from differences of scaling functions, which 
    are computed directly.  It is important to compute kernels in this
    manner to ensure that any errors in the numerical integration 
    collapse when computing the resolution of the identity.
<P>
  </UL>
 Variables:
  <UL>
  <LI>  K_gamma(0:J, 0:B-1): Kernel functions computed for each scale
    [output].
  <LI>  Phi2(0:B-1): Scaling function squared at maximum j=J [output].
  <LI>  bl_scoeff: Upper band limit for scaling coefficients [output].
  <LI>  J: Maximum analysis scale depth [input].
  <LI>  B: Harmonic band limit [input].
  </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 October 2007
<A NAME="function_s2dw_core_phi2_integrand"><H3>s2dw_core_phi2_integrand</H3></A>
<PRE>private function s2dw_core_phi2_integrand (k, bw, alpha) result (integrand)
    real (kind=dp), intent(in) :: k
    integer, intent(in) :: bw
    real (kind=dp), intent(in) :: alpha
    real (kind=dp) :: integrand
end function s2dw_core_phi2_integrand
</PRE>
 Integrand of definite integral to be calculated to compute the scaling 
 function.
<P>
 Notes:
  <UL>
  <LI>  Integrand is given by K_Phi^2(k')/k'.
<P>
  </UL>
 Variables:
  <UL>
  <LI>  k: Dummy (scale) variable of integration [input].
  <LI>  B: Harmonic band limit [input].
  <LI>  alpha: Basis dilation factor [input].
  <LI>  integrand: Value of integrand computed [output].
  </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 October 2007
<A NAME="subroutine_s2dw_core_init_directionality"><H3>s2dw_core_init_directionality</H3></A>
<PRE>public subroutine s2dw_core_init_directionality (Slm, B, N)
    complex (kind=dpc), intent(out), dimension (0:B-1,0:N-1) :: Slm
    integer, intent(in) :: B
    integer, intent(in) :: N
    ! Calls: s2dw_error
end subroutine s2dw_core_init_directionality
</PRE>
 Compute wavelet directionality coefficients.
<P>
 Variables:
  <UL>
  <LI>  Slm(0:B-1, 0:N-1): Directionality coefficients [output].
  <LI>  B: Harmonic band limit [input].
  <LI>  N: Azimuthal band limit [input].
  </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 October 2007
<A NAME="function_s2dw_core_admiss"><H3>s2dw_core_admiss</H3></A>
<PRE>public function s2dw_core_admiss (admiss, K_gamma, Phi2, B, J) result (pass)
    real (kind=dp), intent(out), dimension (0:B-1) :: admiss
    real (kind=dp), intent(in), dimension (0:J,0:B-1) :: K_gamma
    real (kind=dp), intent(in), dimension (0:B-1) :: Phi2
    integer, intent(in) :: B
    integer, intent(in) :: J
    logical :: pass
end function s2dw_core_admiss
</PRE>
 Compute resolution of the identity from scaled kernels and scaling 
 function and check equal to unity for all el.
<P>
 Notes:
  <UL>
  <LI>  Resolution of identity must be unity for all el to ensure 
    admissibility satisfied, i.e. to ensure exact reconstruction is 
    possible.
  <LI>  Resolution of identity computed by
      Phi2(el) + sum_{jj=0}^{J} K_gamma^2(jj,el)     
<P>
  </UL>
 Variables:
  <UL>
  <LI>  admiss(0:B-1): Resolution of the identity computed for each el
    (all values should be close to one if passed admissibility test) 
    [output].
  <LI>  K_gamma(0:J, 0:B-1): Kernel functions computed for each scale
    [input].
  <LI>  Phi2(0:B-1): Scaling function squared at maximum j=J [input].
  <LI>  J: Maximum analysis scale depth [input].
  <LI>  B: Harmonic band limit [input].
  <LI>  pass: Logical specifying whether kernels and scaling function 
    passed admissibilty test [output].
  </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 October 2007
<A NAME="subroutine_s2dw_core_analysis_flm2wav"><H3>s2dw_core_analysis_flm2wav</H3></A>
<PRE>public subroutine s2dw_core_analysis_flm2wav (wav, scoeff, flm, K_gamma, Slm, J, B, N, bl_scoeff, alpha)
    real (kind=dp), intent(out), dimension (0:J, 0:2*B-2, 0:2*B-1, 0:N-1) :: wav
    complex (kind=dpc), intent(out), dimension (0:bl_scoeff-1, 0:bl_scoeff-1) :: scoeff
    complex (kind=dpc), intent(in), dimension (0:B-1, 0:B-1) :: flm
    real (kind=dp), intent(in), dimension (0:J, 0:B-1) :: K_gamma
    complex (kind=dpc), intent(in), dimension (0:B-1, 0:N-1) :: Slm
    integer, intent(in) :: J
    integer, intent(in) :: B
    integer, intent(in) :: N
    integer, intent(in) :: bl_scoeff
    real (kind=dp), intent(in) :: alpha
    ! Calls: dfftw_destroy_plan, dfftw_execute_dft_c2r, dfftw_plan_dft_c2r_1d, s2dw_dl_beta_operator, s2dw_error
end subroutine s2dw_core_analysis_flm2wav
</PRE>
 Compute wavelet and scaling coefficients from harmonic coefficients of 
 original signal using fast algorithm.
<P>
 Notes:
  <UL>
  <LI>  Wavelet and scaling coefficients contain all information required to 
    reconstruct the original signal exactly.
<P>
  </UL>
 Variables:
  <UL>
  <LI>  wav(0:J, 0:2*B-2, 0:2*B-1, 0:N-1): Wavelet coefficients [output].
  <LI>  scoeff(0:bl_scoeff-1, 0:bl_scoeff-1): Scaling coefficients 
    [output].
  <LI>  flm(0:B-1, 0:B-1): Harmonic coefficients of signal [input].
  <LI>  K_gamma(0:J, 0:B-1): Kernel functions computed for each scale
    [input].
  <LI>  Slm(0:B-1, 0:N-1): Directionality coefficients [input].
  <LI>  J: Maximum analysis scale depth [input].
  <LI>  B: Harmonic band limit [input].
  <LI>  N: Azimuthal band limit [input].
  <LI>  bl_scoeff: Upper band limit for scaling coefficients [input].
  <LI>  alpha: Basis dilation factor [input].
  </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 October 2007
<A NAME="subroutine_s2dw_core_analysis_flm2wav_dynamic"><H3>s2dw_core_analysis_flm2wav_dynamic</H3></A>
<PRE>public subroutine s2dw_core_analysis_flm2wav_dynamic (wavdyn, scoeff, flm, K_gamma, Slm, J, B, N, bl_scoeff, alpha)
    type (s2dw_wav_abg), intent(out), allocatable, dimension (:) :: wavdyn
    complex (kind=dpc), intent(out), dimension (0:bl_scoeff-1, 0:bl_scoeff-1) :: scoeff
    complex (kind=dpc), intent(in), dimension (0:B-1, 0:B-1) :: flm
    real (kind=dp), intent(in), dimension (0:J, 0:B-1) :: K_gamma
    complex (kind=dpc), intent(in), dimension (0:B-1, 0:N-1) :: Slm
    integer, intent(in) :: J
    integer, intent(in) :: B
    integer, intent(in) :: N
    integer, intent(in) :: bl_scoeff
    real (kind=dp), intent(in) :: alpha
    ! Calls: dfftw_destroy_plan, dfftw_execute_dft_c2r, dfftw_plan_dft_c2r_1d, s2dw_dl_beta_operator, s2dw_error
end subroutine s2dw_core_analysis_flm2wav_dynamic
</PRE>
 Compute wavelet and scaling coefficients from harmonic coefficients of 
 original signal using fast algorithm, dynamically allocating the memory
 required for the wavelet coefficients dynamically.
<P>
 Notes:
  <UL>
  <LI>  The memory required to store the wavelet coefficients is allocated
    dynamically herein.
  <LI>  Wavelet and scaling coefficients contain all information required to 
    reconstruct the original signal exactly.
<P>
  </UL>
 Variables:
  <UL>
  <LI>  wavdyn(0:J)%coeff: Wavelet coefficients for each scale (memory  
    allocated herein) [output].
  <LI>  scoeff(0:bl_scoeff-1, 0:bl_scoeff-1): Scaling coefficients 
    [output].
  <LI>  flm(0:B-1, 0:B-1): Harmonic coefficients of signal [input].
  <LI>  K_gamma(0:J, 0:B-1): Kernel functions computed for each scale
    [input].
  <LI>  Slm(0:B-1, 0:N-1): Directionality coefficients [input].
  <LI>  J: Maximum analysis scale depth [input].
  <LI>  B: Harmonic band limit [input].
  <LI>  N: Azimuthal band limit [input].
  <LI>  bl_scoeff: Upper band limit for scaling coefficients [input].
  <LI>  alpha: Basis dilation factor [input].
  </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 February 2008
<A NAME="subroutine_s2dw_core_synthesis_wav2flm"><H3>s2dw_core_synthesis_wav2flm</H3></A>
<PRE>public subroutine s2dw_core_synthesis_wav2flm (flm, wav, scoeff, K_gamma, Phi2, Slm, J, B, N, bl_scoeff, alpha)
    complex (kind=dpc), intent(out), dimension (0:B-1, 0:B-1) :: flm
    real (kind=dp), intent(in), dimension (0:J, 0:2*B-2, 0:2*B-1, 0:N-1) :: wav
    complex (kind=dpc), intent(in), dimension (0:bl_scoeff-1, 0:bl_scoeff-1) :: scoeff
    real (kind=dp), intent(in), dimension (0:J, 0:B-1) :: K_gamma
    real (kind=dp), intent(in), dimension (0:B-1) :: Phi2
    complex (kind=dpc), intent(in), dimension (0:B-1, 0:N-1) :: Slm
    integer, intent(in) :: J
    integer, intent(in) :: B
    integer, intent(in) :: N
    integer, intent(in) :: bl_scoeff
    real (kind=dp), intent(in) :: alpha
    ! Calls: dfftw_destroy_plan, dfftw_execute_dft_r2c, dfftw_plan_dft_r2c_1d, s2dw_dl_beta_operator, s2dw_error
end subroutine s2dw_core_synthesis_wav2flm
</PRE>
 Synthesis harmonic coefficients of signal from wavelet and scaling
 coefficients.
<P>
 Notes:
  <UL>
  <LI>  This routines uses less memory than using s2dw_core_synthesis_wav2wig
    followed by s2dw_core_synthesis_wig2flm since the Wigner coefficients
    do not need to be stored for all j.
<P>
  </UL>
 Variables:
  <UL>
  <LI>  flm(0:B-1, 0:B-1): Synthesised harmonic coefficients of signal 
    [output].
  <LI>  wav(0:J, 0:2*B-2, 0:2*B-1, 0:N-1): Wavelet coefficients [input].
  <LI>  scoeff(0:bl_scoeff-1, 0:bl_scoeff-1): Scaling coefficients 
    [input].
  <LI>  K_gamma(0:J, 0:B-1): Kernel functions computed for each scale
    [input].
  <LI>  Phi2(0:B-1): Scaling function squared at maximum j=J [input].
  <LI>  Slm(0:B-1, 0:N-1): Directionality coefficients [input].
  <LI>  J: Maximum analysis scale depth [input].
  <LI>  B: Harmonic band limit [input].
  <LI>  N: Azimuthal band limit [input].
  <LI>  bl_scoeff: Upper band limit for scaling coefficients [input].
  <LI>  alpha: Basis dilation factor [input].
  </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 October 2007
<A NAME="subroutine_s2dw_core_synthesis_wav2flm_dynamic"><H3>s2dw_core_synthesis_wav2flm_dynamic</H3></A>
<PRE>public subroutine s2dw_core_synthesis_wav2flm_dynamic (flm, wavdyn, scoeff, K_gamma, Phi2, Slm, J, B, N, bl_scoeff, alpha)
    complex (kind=dpc), intent(out), dimension (0:B-1, 0:B-1) :: flm
    type (s2dw_wav_abg), intent(inout), allocatable, dimension (:) :: wavdyn
    complex (kind=dpc), intent(in), dimension (0:bl_scoeff-1, 0:bl_scoeff-1) :: scoeff
    real (kind=dp), intent(in), dimension (0:J, 0:B-1) :: K_gamma
    real (kind=dp), intent(in), dimension (0:B-1) :: Phi2
    complex (kind=dpc), intent(in), dimension (0:B-1, 0:N-1) :: Slm
    integer, intent(in) :: J
    integer, intent(in) :: B
    integer, intent(in) :: N
    integer, intent(in) :: bl_scoeff
    real (kind=dp), intent(in) :: alpha
    ! Calls: dfftw_destroy_plan, dfftw_execute_dft_r2c, dfftw_plan_dft_r2c_1d, s2dw_dl_beta_operator, s2dw_error
end subroutine s2dw_core_synthesis_wav2flm_dynamic
</PRE>
 Synthesise harmonic coefficients of signal from wavelet and scaling
 coefficients, where the memory of the wavelet coefficients has been 
 allocated dynamically (destroying wavelet coefficients in the process).
<P>
 Notes:
  <UL>
  <LI>  The wavelet coefficients are destroyed by this routine and their 
    memory is freed.
  <LI>  This routines uses less memory than using s2dw_core_synthesis_wav2wig
    followed by s2dw_core_synthesis_wig2flm since the Wigner coefficients
    do not need to be stored for all j.
<P>
  </UL>
 Variables:
  <UL>
  <LI>  flm(0:B-1, 0:B-1): Synthesised harmonic coefficients of signal 
    [output].
  <LI>  wavdyn(0:J)%coeff: Wavelet coefficients for each scale (destroyed 
    and freed on output) [input/output].
  <LI>  scoeff(0:bl_scoeff-1, 0:bl_scoeff-1): Scaling coefficients 
    [input].
  <LI>  K_gamma(0:J, 0:B-1): Kernel functions computed for each scale
    [input].
  <LI>  Phi2(0:B-1): Scaling function squared at maximum j=J [input].
  <LI>  Slm(0:B-1, 0:N-1): Directionality coefficients [input].
  <LI>  J: Maximum analysis scale depth [input].
  <LI>  B: Harmonic band limit [input].
  <LI>  N: Azimuthal band limit [input].
  <LI>  bl_scoeff: Upper band limit for scaling coefficients [input].
  <LI>  alpha: Basis dilation factor [input].
  </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 February 2008
<A NAME="subroutine_s2dw_core_free_wavdyn"><H3>s2dw_core_free_wavdyn</H3></A>
<PRE>public subroutine s2dw_core_free_wavdyn (wavdyn)
    type (s2dw_wav_abg), intent(inout), allocatable, dimension (:) :: wavdyn
end subroutine s2dw_core_free_wavdyn
</PRE>
 Free memory corresponding to dynamically allocated wavelet coefficients.
<P>
 Variables:
  <UL>
  <LI>  wavdyn(0:J)%coeff: Wavelet coefficients for each scale (destroyed 
    and freed on output) [input/output].
  </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 February 2008
<A NAME="function_s2dw_core_params_valid"><H3>s2dw_core_params_valid</H3></A>
<PRE>private function s2dw_core_params_valid (J, B, alpha, N) result (valid)
    integer, intent(in) :: J
    integer, intent(in) :: B
    real (kind=dp), intent(in) :: alpha
    integer, optional, intent(in) :: N
    logical :: valid
end function s2dw_core_params_valid
</PRE>
 Check size parameters valid.
<P>
 Notes:
  <UL>
  <LI>  Only needs to be called once when initialising Kernels, then array 
    sizes ensure other objects of correct size.
<P>
  </UL>
 Variables:
  <UL>
  <LI>  J: Maximum analysis scale depth [input].
  <LI>  B: Harmonic band limit [input].
  <LI>  N: Azimuthal band limit [input].
  <LI>  valid: Logical specifying whether passed parameter check [output].
  </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 October 2007
<A NAME="function_s2dw_core_comp_jmax"><H3>s2dw_core_comp_Jmax</H3></A>
<PRE>public function s2dw_core_comp_Jmax (B, alpha) result (J_max)
    integer, intent(in) :: B
    real (kind=dp), intent(in) :: alpha
    integer :: J_max
end function s2dw_core_comp_Jmax
</PRE>
 Compute maximum analysis depth allowed.
<P>
 Variables:
  <UL>
  <LI>  B: Harmonic band limit [input].
  <LI>  J_max: Maximum analysis scale depth allowed [output].
  </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 November 2007
<A NAME="function_s2dw_core_assimilate_int"><H3>s2dw_core_assimilate_int</H3></A>
<PRE>public function s2dw_core_assimilate_int (x, y) result (assimilated)
    real (kind=dp), intent(in) :: x
    integer, intent(out) :: y
    logical :: assimilated
end function s2dw_core_assimilate_int
</PRE>
 If a real value is very close to an integer then set to integer, 
 otherwise leave unaltered.  Necessary to avoid numerical precision 
 problems when using ceiling and floor functions.
<P>
 Variables:
  <UL>
  <LI>  x: Input value to (possibly) assimilate to integer [input].
  <LI>  y: Value x is assimilated to (or 0 if not assimilated) [output].
  <LI>  assimilated: Logical indicating where assimilation occured [output].
  </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 November 2007
<A NAME="function_quad_weights"><H3>quad_weights</H3></A>
<PRE>private function quad_weights (theta_t, B) result (w)
    real (kind=dp), intent(in) :: theta_t
    integer, intent(in) :: B
    real (kind=dp) :: w
end function quad_weights
</PRE>
 Compute quadrature weights for exact quadrature with measure 
 dcos(theta).  Weights are derived by Driscoll and Healy.
<P>
 Variables:
  <UL>
  <LI>  theta_t: Theta value to compute weight for [input].
  <LI>  B: Harmonic band limit [input].
  <LI>  w: Corresponding weight [output]
  </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 October 2007
<A NAME="function_binomial"><H3>binomial</H3></A>
<PRE>private function binomial (n, r) result (b)
    integer, intent(in) :: n
    integer, intent(in) :: r
    integer :: b
end function binomial
</PRE>
 Compute Binomial coefficient nCr.
<P>
 Variables:
  <UL>
  <LI>  n: Upper Binomial coefficient index [input].
  <LI>  r: Lower Binomial coefficient index [input].
  <LI>  b: Binomial coefficient value [output].
  </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 October 2007
<A NAME="function_logfact"><H3>logfact</H3></A>
<PRE>private function logfact (n) result (logfactn)
    integer, intent(in) :: n
    real (kind=dp) :: logfactn
    ! Calls: s2dw_error
end function logfact
</PRE>
 Computes the natural logarithm of an (integer) factorial.
<P>
 Variables:
  <UL>
  <LI>  n: Integer to compute factorial of [input].
  <LI>  logfactn: Natural logarithm of factorial value computed [output].
  </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 October 2007
<A NAME="subroutine_trapzd"><H3>trapzd</H3></A>
<PRE>private subroutine trapzd (func, B, alpha, a_lim, b_lim, s, n)
    interface func
        function func (k, B, alpha) result (integrand)
            real (kind=dp), intent(in) :: k
            integer, intent(in) :: B
            real (kind=dp), intent(in) :: alpha
            real (kind=dp) :: integrand
        end function func
    end interface func
    integer, intent(in) :: B
    real (kind=dp), intent(in) :: alpha
    real (kind=dp), intent(IN) :: a_lim
    real (kind=dp), intent(IN) :: b_lim
    real (kind=dp), intent(INOUT) :: s
    integer, intent(IN) :: n
end subroutine trapzd
</PRE>
 Computes nth stage of refinement of extended trapezoidal rule.
 Adapted from numerical recipes for computing scaling functions squared.
<P>
 Notes:
   <UL>
   <LI>  Numerical recipies comment:
     This routine computes the nth stage of refinement of an extended 
     trapezoidal rule. func is input as the name of the function to be 
     integrated between limits a and b, also input. When called with
     n=1, the routine returns as s the crudest estimate of 
     int_b^a f(x)dx. Subsequent calls with n=2,3,... (in that sequential
     order) will improve the accuracy of s by adding 2n-2 additional
     interior points. s should not be modified between sequential calls.
   <LI>  Adapted for use in evaluating integrals required to compute
     scaling functions squared (i.e. also takes parameters required 
     to compute these integrals).
<P>
   </UL>
 Variables:
   <UL>
   <LI>  func: "Pointer" to integrand function [input].
   <LI>  B: Harmonic band limit parameter for integrand function [input].
   <LI>  alpha:Basis dilation factor for integrand function [input].
   <LI>  a_lim: Lower limit to evalue definite integral for [input].
   <LI>  b_lim: Upper limit to evalue definite integral for [input].
   <LI>  s: Value of integral computed to current order [input].
   <LI>  n: Refinement order [output].
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 June 2005
<A NAME="function_qtrap"><H3>qtrap</H3></A>
<PRE>private function qtrap (func, B, alpha, a_lim, b_lim) result (integral)
    interface func
        function func (k, B, alpha) result (integrand)
            real (kind=dp), intent(in) :: k
            integer, intent(in) :: B
            real (kind=dp), intent(in) :: alpha
            real (kind=dp) :: integrand
        end function func
    end interface func
    integer, intent(in) :: B
    real (kind=dp), intent(in) :: alpha
    real (kind=dp), intent(in) :: a_lim
    real (kind=dp), intent(in) :: b_lim
    real (kind=dp) :: integral
    ! Calls: s2dw_error, trapzd
end function qtrap
</PRE>
 Computes the integral of the function func from a to b using the 
 trapezoid method.  Adapted from numerical recipes for computing scaling 
 functions squared.
<P>
 Notes:
   <UL>
   <LI>  Numerical recipies comment:
     Returns the integral of the function func from a to b. 
     The parameter EPS should be set to the desired fractional accuracy
     and JMAX so that 2 to the power JMAX-1 is the maximum allowed
     number of steps. Integration is performed by the trapezoidal rule.
   <LI>  Adapted for use in evaluating integrals required to compute
     scaling functions squared (i.e. also takes parameters required 
     to compute these integrals).
<P>
   </UL>
 Variables:
   <UL>
   <LI>  func: "Pointer" to integrand function [input].
   <LI>  B: Harmonic band limit parameter for integrand function [input].
   <LI>  alpha:Basis dilation factor for integrand function [input].
   <LI>  a_lim: Lower limit to evalue definite integral for [input].
   <LI>  b_lim: Upper limit to evalue definite integral for [input].
   <LI>  integral: Value of the evaluated integral [output].
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 June 2005
<A NAME="function_qsimp"><H3>qsimp</H3></A>
<PRE>private function qsimp (func, B, alpha, a_lim, b_lim) result (integral)
    interface func
        function func (k, B, alpha) result (integrand)
            real (kind=dp), intent(in) :: k
            integer, intent(in) :: B
            real (kind=dp), intent(in) :: alpha
            real (kind=dp) :: integrand
        end function func
    end interface func
    integer, intent(in) :: B
    real (kind=dp), intent(in) :: alpha
    real (kind=dp), intent(IN) :: a_lim
    real (kind=dp), intent(IN) :: b_lim
    real (kind=dp) :: integral
    ! Calls: s2dw_error, trapzd
end function qsimp
</PRE>
 Computes the integral of the function func from a to b using
 Simpson's rule.  Adapted from numerical recipes for computing scaling 
 functions squared.
<P>
 Notes:
   <UL>
   <LI>  Numerical recipies comment:
     Returns the integral of the function func from a to b.
     The parameter EPS should be set to the desired fractional 
     accuracy and JMAX so that 2 to the power JMAX-1 is the maximum
     allowed number of steps. Integration is performed by Simpson's rule.
   <LI>  Adapted for use in evaluating integrals required to compute
     scaling functions squared (i.e. also takes parameters required 
     to compute these integrals).
<P>
   </UL>
 Variables:
   <UL>
   <LI>  func: "Pointer" to integrand function [input].
   <LI>  B: Harmonic band limit parameter for integrand function [input].
   <LI>  alpha:Basis dilation factor for integrand function [input].
   <LI>  a_lim: Lower limit to evalue definite integral for [input].
   <LI>  b_lim: Upper limit to evalue definite integral for [input].
   <LI>  integral: Value of the evaluated integral [output].
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 June 2005
</HTML>
